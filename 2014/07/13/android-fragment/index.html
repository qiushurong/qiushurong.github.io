<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.useso.com/css?family=Monda:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="fragment," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/head.ico?v=5.0.1" />






<meta name="description" content="注：内容部分转载自傲慢的上校。
## 
## 
Fragment要点&amp;nbsp;
1.  Fragment作为Activity界面的一部分组成出现2.  可以在一个Activity中同时出现多个Fragment，并且，一个Fragment亦可在多个Activity中使用。3.  在Activity运行过程中，可以添加、移除或者替换Fragment（add()、remove()、replace()）">
<meta property="og:type" content="article">
<meta property="og:title" content="Android之碎片Fragment详解">
<meta property="og:url" content="http://yoursite.com/2014/07/13/android-fragment/index.html">
<meta property="og:site_name" content="小树技术博客">
<meta property="og:description" content="注：内容部分转载自傲慢的上校。
## 
## 
Fragment要点&amp;nbsp;
1.  Fragment作为Activity界面的一部分组成出现2.  可以在一个Activity中同时出现多个Fragment，并且，一个Fragment亦可在多个Activity中使用。3.  在Activity运行过程中，可以添加、移除或者替换Fragment（add()、remove()、replace()）">
<meta property="og:image" content="http://www.qiushurong.cn/wp-content/uploads/2014/07/fragments-view-300x173.png">
<meta property="og:image" content="http://www.qiushurong.cn/wp-content/uploads/2014/07/fragment_lifecycle-112x300.png">
<meta property="og:image" content="http://www.qiushurong.cn/wp-content/uploads/2014/07/activity_fragment_lifecycle-151x300.png">
<meta property="og:updated_time" content="2016-04-28T14:05:28.753Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android之碎片Fragment详解">
<meta name="twitter:description" content="注：内容部分转载自傲慢的上校。
## 
## 
Fragment要点&amp;nbsp;
1.  Fragment作为Activity界面的一部分组成出现2.  可以在一个Activity中同时出现多个Fragment，并且，一个Fragment亦可在多个Activity中使用。3.  在Activity运行过程中，可以添加、移除或者替换Fragment（add()、remove()、replace()）">
<meta name="twitter:image" content="http://www.qiushurong.cn/wp-content/uploads/2014/07/fragments-view-300x173.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 5322878,
      author: '小树'
    }
  };
</script>

  <title> Android之碎片Fragment详解 | 小树技术博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  

  <div class="container one-collumn  page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">小树技术博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">用文字留住时间、用博客记录生命</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android之碎片Fragment详解
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-07-13T13:31:57+08:00" content="2014-07-13">
              2014-07-13
            </time>
          </span>

<span class="post-count">&nbsp; | &nbsp;字数 6,185</span>
<span class="post-count">&nbsp; | &nbsp;预计阅读 26分钟</span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android开发/" itemprop="url" rel="index">
                    <span itemprop="name">Android开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/07/13/android-fragment/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/07/13/android-fragment/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>注：内容部分转载自<a href="http://blog.csdn.net/lilu_leo/article/details/7671533/" title="傲慢的上校博客" target="_blank" rel="external">傲慢的上校</a>。</p>
<p>## </p>
<p>## </p>
<h2 id="Fragment要点"><a href="#Fragment要点" class="headerlink" title="Fragment要点"></a>Fragment要点</h2><p>&nbsp;</p>
<div style="color: #362e2b;"><br><br>1.  Fragment作为Activity界面的一部分组成出现<br>2.  可以在一个Activity中同时出现多个Fragment，并且，一个Fragment亦可在多个Activity中使用。<br>3.  在Activity运行过程中，可以添加、移除或者替换Fragment（add()、remove()、replace()）<br>4.  Fragment可以响应自己的输入事件，并且有自己的生命周期，当然，它们的生命周期直接被其所属的宿主activity的生命周期影响。.<br>&nbsp;<br><br>## 设计哲学<br><br>&nbsp;<br><br>Android在3.0中引入了fragments的概念,主要目的是用在大屏幕设备上–例如平板电脑上,支持更加动态和灵活的UI设计。平板电脑的屏幕要比手机的大得多,有更多的空间来放更多的UI组件,并且这些组件之间会产生更多的交互。Fragment允许这样的一种设计,而不需要你亲自来管理 viewhierarchy的复杂变化。 通过将activity的布局分散到fragment中, 你可以在运行时修改activity的外观,并在由activity管理的back stack中保存那些变化.<br><br>官方wifi地址：<a href="http://developer.android.com/guide/topics/fundamentals/fragments.html" title="android-fragment-url" target="_blank" rel="external">飞机票</a><br><br>例如, 一个新闻应用可以在屏幕左侧使用一个fragment来展示一个文章的列表,然后在屏幕右侧使用另一个fragment来展示一篇文章–2个fragment并排显示在相同的一个activity中,并且每一个fragment拥有它自己的一套生命周期回调方法,并且处理它们自己的用户输入事件。 因此, 取代使用一个activity来选择一篇文章而另一个activity来阅读文章的方式,用户可以在同一个activity中选择一篇文章并且阅读, 如图所示:<br><br><a href="http://www.qiushurong.cn/wp-content/uploads/2014/07/fragments-view.png" target="_blank" rel="external"><img src="http://www.qiushurong.cn/wp-content/uploads/2014/07/fragments-view-300x173.png" alt="fragments-view"></a><br><br>&nbsp;<br><br>fragment在你的应用中应当是一个模块化和可重用的组件.即,因为fragment定义了它自己的布局, 以及通过使用它自己的生命周期回调方法定义了它自己的行为,你可以将fragment包含到多个activity中. 这点特别重要, 因为这允许你将你的用户体验适配到不同的屏幕尺寸.举个例子,你可能会仅当在屏幕尺寸足够大时,在一个activity中包含多个fragment,并且,当不属于这种情况时,会启动另一个单独的,使用不同fragment的activity.<br><br>继续之前那个新闻的例子 – 当运行在一个特别大的屏幕时(例如平板电脑),应用可以在Activity A中嵌入2个fragment。然而,在一个正常尺寸的屏幕(例如手机)上,没有足够的空间同时供2个fragment用, 因此, Activity A会仅包含文章列表的fragment, 而当用户选择一篇文章时, 它会启动ActivityB,它包含阅读文章的fragment.因此, 应用可以同时支持上图中的2种设计模式。<br><br>&nbsp;<br><br>## 创建Fragment<br><br>&nbsp;<br><div>要创建一个fragment, 必须创建一个 Fragment 的子类 (或者继承自一个已存在的它的子类). Fragment类的代码看起来很像 Activity 。它包含了和activity类似的回调方法, 例如onCreate()、 onStart()、onPause()以及 onStop()。事实上, 如果你准备将一个现成的Android应用转换到使用fragment,可能只需简单的将代码从你的activity的回调方法分别移动到你的fragment的回调方法即可。</div><br><div><br><br><strong><span style="color: #ff0000;">通常, 应当至少实现如下的生命周期方法:</span></strong><br><br><em>   <strong>onCreate()</strong><br>当创建fragment时, 系统调用该方法.<br>在实现代码中,应当初始化想要在fragment中保持的必要组件, 当fragment被暂停或者停止后可以恢复.
</em>   <strong>onCreateView()</strong><br>fragment第一次绘制它的用户界面的时候, 系统会调用此方法. 为了绘制fragment的UI,此方法必须返回一个View, 这个view是你的fragment布局的根view. 如果fragment不提供UI, 可以返回null.<br><em>   <em>*onPause()
</em></em>用户将要离开fragment时,系统调用这个方法作为第一个指示(然而它不总是意味着fragment将被销毁.) 在当前用户会话结束之前,通常应当在这里提交任何应该持久化的变化(因为用户有可能不会返回).<br><br>其生命周期图如下：<br><br><a href="http://www.qiushurong.cn/wp-content/uploads/2014/07/fragment_lifecycle.png" target="_blank" rel="external"><img src="http://www.qiushurong.cn/wp-content/uploads/2014/07/fragment_lifecycle-112x300.png" alt="fragment_lifecycle"></a><br><br></div>

<p>大多数应用应当为每一个fragment实现至少这3个方法,但是还有一些其他回调方法你也应当用来去处理fragment生命周期的各种阶段.全部的生命周期回调方法将会在后面章节 Handlingthe Fragment Lifecycle 中讨论.</p>
<p><strong><span style="color: #ff0000;">除了继承基类 Fragment , 还有一些子类你可能会继承:</span></strong></p>
<ul>
<li><strong><span style="color: #ff0000;">DialogFragment</span>
</strong>显示一个浮动的对话框.<br>用这个类来创建一个对话框,是使用在Activity类的对话框工具方法之外的一个好的选择,<br>因为你可以将一个fragment对话框合并到activity管理的fragment back stack中,允许用户返回到一个之前曾被摒弃的fragment.</li>
<li><strong><span style="color: #ff0000;">ListFragment</span>
</strong>显示一个由一个adapter(例如 SimpleCursorAdapter)管理的项目的列表, 类似于ListActivity.<br>它提供一些方法来管理一个list view, 例如 onListItemClick()回调来处理点击事件.</li>
<li><span style="color: #ff0000;"><strong>PreferenceFragment</strong></span><br>显示一个 Preference对象的层次结构的列表, 类似于PreferenceActivity.<br>这在为你的应用创建一个”设置”activity时有用处.<br>&nbsp;</li>
</ul>
<h3 id="添加一个用户界面"><a href="#添加一个用户界面" class="headerlink" title="添加一个用户界面"></a>添加一个用户界面</h3><p>&nbsp;</p>
<div><br><br>fragment通常用来作为一个activity的用户界面的一部分,并将它的layout提供给activity.为了给一个fragment提供一 个layout,你必须实现 onCreateView()回调方法, 当到了fragment绘制它自己的layout的时候,Android系统调用它.你的此方法的实现代码必须返回一个你的fragment的 layout的根view.<br><span style="color: #ff0000;"><strong>注意</strong></span><span style="color: #ff0000;">:</span> 如果你的fragment是ListFragment的子类,它的默认实现是返回从onCreateView()返回一个ListView,所以一般情况下不必实现它.<br>从onCreateView()返回的View, 也可以从一个layout的xml资源文件中读取并生成. 为了帮助你这么做, onCreateView() 提供了一个LayoutInflater 对象.<br><br>举个例子, 这里有一个Fragment的子类, 从文件 example_fragment.xml 加载了一个layout:<br><pre class="lang:java decode:true " title="demo">public static class ExampleFragment extends Fragment {<br>    @Override<br>    public View onCreateView(LayoutInflater inflater, ViewGroup container,<br>                             Bundle savedInstanceState) {<br>        // Inflate the layout for this fragment<br>        return inflater.inflate(R.layout.example_fragment, container, false);<br>    }<br>}</pre><br>&nbsp;<br><br>传入onCreateView()的container参数是你的fragmentlayout将被插入的父ViewGroup(来自activity的layout)  savedInstanceState 参数是一个Bundle, 如果fragment是被恢复的,它提供关于fragment的之前的实例的数据,<br><br>inflate() 方法有3个参数:<br><br><em>   想要加载的layout的resource ID.
</em>   加载的layout的父ViewGroup.<br>传入container是很重要的, 目的是为了让系统接受所要加载的layout的根view的layout参数,<br>由它将挂靠的父view指定.<br><em>   布尔值指示在加载期间, 展开的layout是否应当附着到ViewGroup (第二个参数).<br>(在这个例子中, 指定了false, 因为系统已经把展开的layout插入到container –传入true会在最后的layout中创建一个多余的view group.)<br><br>### <a style="color: #6a3906;" name="t4"></a><strong>将fragment添加到activity</strong><br><br>&nbsp;<br><br>通常地, fragment为宿主activity提供UI的一部分, 被作为activity的整个viewhierarchy的一部分被嵌入. 有2种方法你可以添加一个fragment到activity layout:<br><br><strong>在activity的layout文件中声明fragment</strong><br>在这种情况下，你可以像为View一样, 为fragment指定layout属性.例子是一个有2个fragment的activity的layout:<br><pre class="lang:java decode:true " title="layout">&lt;?xml version=”1.0” encoding=”utf-8”?&gt;<br>&lt;LinearLayout xmlns:android=”<a href="http://schemas.android.com/apk/res/android" target="_blank" rel="external">http://schemas.android.com/apk/res/android</a>“<br>    android:orientation=”horizontal”<br>    android:layout_width=”match_parent”<br>    android:layout_height=”match_parent”&gt;<br>    &lt;fragment android:name=”com.example.news.ArticleListFragment”<br>            android:id=”@+id/list”<br>            android:layout_weight=”1”<br>            android:layout_width=”0dp”<br>            android:layout_height=”match_parent” /&gt;<br>    &lt;fragment android:name=”com.example.news.ArticleReaderFragment”<br>            android:id=”@+id/viewer”<br>            android:layout_weight=”2”<br>            android:layout_width=”0dp”<br>            android:layout_height=”match_parent” /&gt;<br>&lt;/LinearLayout&gt;</pre><br>&nbsp;<br><div>&lt;fragment&gt; 中的 android:name属性指定了在layout中实例化的Fragment类.<br>当系统创建这个activity layout时,它实例化每一个在layout中指定的fragment,并调用每一个上的onCreateView()方法,来获取每一个 fragment的layout.系统将从fragment返回的 View直接插入到&lt;fragment&gt;元素所在的地方.<br><em>*<span style="color: red;">注意</span></em></div></em><span style="color: red;">:</span> 每一个fragment都需要一个唯一的标识,如果activity重启,系统可以用来恢复fragment(并且你也可以用来捕获fragment来处理事务,例如移除它.)</div>

<p>有3种方法来为一个fragment提供一个标识:</p>
<ul>
<li>为 android:id 属性提供一个唯一ID.</li>
<li>为 android:tag 属性提供一个唯一字符串.</li>
<li>如果以上2个你都没有提供, 系统使用容器view的ID.</li>
</ul>
<h3 id="撰写代码将fragment添加到一个已存在的ViewGroup"><a href="#撰写代码将fragment添加到一个已存在的ViewGroup" class="headerlink" title="撰写代码将fragment添加到一个已存在的ViewGroup."></a><a style="color: #6a3906;" name="t5"></a><strong>撰写代码将fragment添加到一个已存在的ViewGroup.</strong></h3><p>当activity运行的任何时候, 都可以将fragment添加到activity layout.只需简单的指定一个需要放置fragment的ViewGroup.为了在你的 activity中操作fragment事务(例如添加,移除,或代替一个fragment),必须使用来自FragmentTransaction 的API.<br>可以按如下方法,从你的Activity取得一个 FragmentTransaction 的实例:</p>
<p><pre class="lang:java decode:true " title="FragmentManager ">FragmentManager fragmentManager =getFragmentManager();<br>FragmentTransaction fragmentTransaction =fragmentManager.beginTransaction();</pre><br>然后你可以使用 add() 方法添加一个fragment, 指定要添加的fragment和要插入的view.</p>
<p><pre class="lang:java decode:true " title="ExampleFragment ">ExampleFragment fragment = newExampleFragment();<br>fragmentTransaction.add(R.id.fragment_container,fragment);<br>fragmentTransaction.commit();</pre><br>&nbsp;</p>
<p>add()的第一个参数是fragment要放入的ViewGroup, 由resource ID指定,第二个参数是需要添加的fragment.一旦用FragmentTransaction做了改变,为了使改变生效,必须调用commit().</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3 id="添加一个无UI的fragment"><a href="#添加一个无UI的fragment" class="headerlink" title="添加一个无UI的fragment"></a><a style="color: #6a3906;" name="t6"></a><strong>添加一个无UI的fragment</strong></h3><p>&nbsp;</p>
<p>之前的例子展示了对UI的支持, 如何将一个fragment添加到activity.然而,也可以使用fragment来为activity提供后台行为而不用展现额外的UI.<br>要添加一个无UI的fragment, 需要从activity使用 add(Fragment, String)来添加fragment (为fragment提供一个唯一的字符串”tag”, 而不是一个view ID).这么做添加了fragment,但因为它没有关联到一个activity layout中的一个view, 所以不会接收到onCreateView()调用.因此不必实现此方法.<br>为fragment提供一个字符串tag并不是专门针对无UI的fragment的–也可以提供字符串tag给有UI的fragment–但是如果fragment没有UI,那么这个tag是仅有的标识它的途径.如果随后你想从activity获取这个fragment, 需要使用 findFragmentByTag().</p>
<h2 id="管理Fragment"><a href="#管理Fragment" class="headerlink" title="管理Fragment"></a><a style="color: #6a3906;" name="t7"></a><strong>管理Fragment</strong></h2><p>&nbsp;</p>
<p>要在activity中管理fragment,需要使用FragmentManager. 通过调用activity的getFragmentManager()取得它的实例.可以通过FragmentManager做一些事情, 包括:</p>
<ul>
<li>使用findFragmentById()(用于在activity layout中提供一个UI的fragment)或findFragmentByTag()(适用于有或没有UI的fragment)获取activity中存在的fragment</li>
<li>将fragment从后台堆栈中弹出, 使用 popBackStack() (模拟用户按下BACK 命令).</li>
<li>使用addOnBackStackChangeListener()注册一个监听后台堆栈变化的listener.<div></div>

</li>
</ul>
<h2 id="处理Fragment事务"><a href="#处理Fragment事务" class="headerlink" title="处理Fragment事务"></a><a style="color: #6a3906;" name="t8"></a>处理Fragment事务</h2><p>&nbsp;</p>
<div><br><br>关于在activity中使用fragment的很强的一个特性是:根据用户的交互情况,对fragment进行添加,移除,替换,以及执行其他动作.提交给activity的每一套变化被称为一个事务,可以使用在FragmentTransaction中的 API 处理.我们也可以保存每一个事务到一个activity管理的backstack,允许用户经由fragment的变化往回导航(类似于通过 activity往后导航).<br><br>从 FragmentManager 获得一个FragmentTransaction实例 :<br><pre class="lang:java decode:true " title="fragmentTransaction ">FragmentManager fragmentManager =getFragmentManager();<br>FragmentTransaction fragmentTransaction =fragmentManager.beginTransaction();</pre><br>每一个事务都是同时要执行的一套变化.可以在一个给定的事务中设置你想执行的所有变化,使用诸如 add()、remove()和 replace().然后, 要给activity应用事务, 必须调用 commit().<br><br>在调用commit()之前, 你可能想调用 addToBackStack(),将事务添加到一个fragment事务的backstack. 这个back stack由activity管理, 并允许用户通过按下 BACK按键返回到前一个fragment状态.<br><br>举个例子, 这里是如何将一个fragment替换为另一个, 并在后台堆栈中保留之前的状态:<br><pre class="lang:java decode:true " title="demo">// Create new fragment and transaction<br>Fragment newFragment = newExampleFragment();<br>FragmentTransaction transaction =getFragmentManager().beginTransaction();<br>// Replace whatever is in thefragment_container view with this fragment,<br>// and add the transaction to the backstack<br>transaction.replace(R.id.fragment_container,newFragment);<br>transaction.addToBackStack(null);<br>// Commit the transaction<br>transaction.commit();</pre><br>&nbsp;<br><div><br><br>在这个例子中,newFragment替换了当前layout容器中的由R.id.fragment_container标识的fragment.通过调用 addToBackStack(), replace事务被保存到back stack,因此用户可以回退事务,并通过按下BACK按键带回前一个fragment.<br><br>如果添加多个变化到事务(例如add()或remove())并调用addToBackStack(),然后在你调用commit()之前的所有应用的变化会被作为一个单个事务添加到后台堆栈, BACK按键会将它们一起回退.<br>添加变化到 FragmentTransaction的顺序不重要, 除以下例外:<br><br><em>   必须最后调用 commit().
</em>   如果添加多个fragment到同一个容器, 那么添加的顺序决定了它们在view hierarchy中显示的顺序.<br>当执行一个移除fragment的事务时, 如果没有调用 addToBackStack(), 那么当事务提交后,那个fragment会被销毁,并且用户不能导航回到它. 有鉴于此, 当移除一个fragment时,如果调用了addToBackStack(), 那么fragment会被停止, 如果用户导航回来,它将会被恢复.<br><br><strong><span style="color: navy;">提示:</span></strong> 对于每一个fragment事务, 你可以应用一个事务动画,通过在提交事务之前调用setTransition()实现.<br><br>调用 commit() 并不立即执行事务.恰恰相反, 它将事务安排排期, 一旦准备好,就在activity的UI线程上运行(主线程).如果有必要, 无论如何, 你可以从你的UI线程调用executePendingTransactions()来立即执行由commit()提交的事务. 但这么做通常不必要,除非事务是其他线程中的任务的一个从属.<br><br><strong><span style="color: red;">警告</span></strong>:你只能在activity保存它的状态(当用户离开activity)之前使用commit()提交事务.<br><br></div>

<h2 id="与Activity通信"><a href="#与Activity通信" class="headerlink" title="与Activity通信"></a><a style="color: #6a3906;" name="t9"></a>与Activity通信</h2><p>&nbsp;</p>
<div><br><br>尽管Fragment被实现为一个独立于Activity的对象,并且可以在多个activity中使用,但一个给定的fragment实例是直接绑定到包含它的activity的. 特别的,fragment可以使用 getActivity() 访问Activity实例, 并且容易地执行比如在activity layout中查找一个view的任务.<br><pre class="lang:java decode:true ">View listView =getActivity().findViewById(R.id.list);</pre><br>同样地,activity可以通过从FragmentManager获得一个到Fragment的引用来调用fragment中的方法, 使用findFragmentById() 或 findFragmentByTag().<br><pre class="lang:java decode:true">ExampleFragment fragment<br>=(ExampleFragment) getFragmentManager().findFragmentById(R.id.example_fragment);</pre><br>&nbsp;<br><br>### 为Activity创建事件回调方法<br><br>&nbsp;<br><br>在一些情况下, 你可能需要一个fragment与activity分享事件. 一个好的方法是在fragment中定义一个回调的interface, 并要求宿主activity实现它.当activity通过interface接收到一个回调, 必要时它可以和在layout中的其他fragment分享信息.<br>例如, 如果一个新的应用在activity中有2个fragment – 一个用来显示文章列表(framgent A), 另一个显示文章内容(fragment B) – 然后 framgent A必须告诉activity何时一个list item被选中,然后它可以告诉fragmentB去显示文章.<br>在这个例子中, OnArticleSelectedListener 接口在fragment A中声明:<br><pre class="lang:java decode:true " title="Activity ">public static class FragmentA extends ListFragment {<br>    …<br>    // Container Activity must implement this interface<br>    public interface OnArticleSelectedListener {<br>        public void onArticleSelected(Uri articleUri);<br><br>    }<br>    …<br>}</pre><br>然后fragment的宿主activity实现 OnArticleSelectedListener 接口, 并覆写 onArticleSelected() 来通知fragment B,从fragment A到来的事件.为了确保宿主activity实现这个接口, fragment A的 onAttach() 回调方法(当添加fragment到activity时由系统调用) 通过将作为参数传入onAttach()的Activity做类型转换来实例化一个OnArticleSelectedListener实例.<br><pre class="lang:java decode:true " title="onAttach">public static class FragmentA extends ListFragment {<br>    OnArticleSelectedListener mListener;<br>    …<br>    @Override<br>    public void onAttach(Activity activity) {<br>        super.onAttach(activity);<br>        try {<br>            mListener = (OnArticleSelectedListener) activity;<br>         } catch (ClassCastException e) {<br>            throw new ClassCastException(activity.toString() + “ must implementOnArticleSelectedListener”);<br>        }<br>    }<br>    …<br><br>}</pre><br>如果activity没有实现接口, fragment会抛出 ClassCastException 异常. 正常情形下,mListener成员会保持一个到activity的OnArticleSelectedListener实现的引用, 因此fragment A可以通过调用在OnArticleSelectedListener接口中定义的方法分享事件给activity.例如, 如果fragment A是一个 ListFragment的子类, 每次用户点击一个列表项, 系统调用在fragment中的onListItemClick(),然后后者调用 onArticleSelected() 来分配事件给activity.<br><pre class="lang:java decode:true " title="onListItemClick">public static class FragmentA extends ListFragment {<br>    OnArticleSelectedListener mListener;<br>    …<br>    @Override<br>    public void onListItemClick(ListView l, View v, int position, long id) {<br>        // Append the clicked item’s row ID with the content provider Uri<br>         Uri noteUri =ContentUris.withAppendedId(ArticleColumns.CONTENT_URI, id);<br>        // Send the event and Uri to the host activity<br>       mListener.onArticleSelected(noteUri);<br>    }<br><br>    …<br><br>}</pre><br>&nbsp;<br><div>传给 onListItemClick() 的 id 参数是被点击的项的行ID, activity(或其他fragment)用来从应用的 ContentProvider 获取文章.<br><br>### <a style="color: #6a3906;" name="t11"></a>添加项目到ActionBar<br><br></div><br><div><br><br>          你的fragment可以通过实现 onCreateOptionMenu() 提供菜单项给activity的选项菜单(以此类推, Action Bar也一样).为了使这个方法接收调用,无论如何, 你必须在 onCreate() 期间调用 setHasOptionsMenu() 来指出fragment愿意添加item到选项菜单(否则, fragment将接收不到对 onCreateOptionsMenu()的调用)．<br>随后从fragment添加到Option菜单的任何项,都会被追加到现有菜单项的后面.当一个菜单项被选择, fragment也会接收到 对 onOptionsItemSelected() 的回调.也可以在你的fragment layout中通过调用registerForContextMenu() 注册一个view来提供一个环境菜单.当用户打开环境菜单, fragment接收到一个对 onCreateContextMenu() 的调用.当用户选择一个项目, fragment接收到一个对onContextItemSelected() 的调用.<br><br><span style="color: rgb(255, 0, 0);">注意</span>: 尽管你的fragment会接收到它所添加的每一个菜单项被选择后的回调,  但实际上当用户选择一个菜单项时, activity会首先接收到对应的回调.如果activity的on-item-selected回调函数实现并没有处理被选中的项目, 然后事件才会被传递到fragment的回调.<br><br>这个规则适用于选项菜单和环境菜单.<br><br>&nbsp;<br><br>## <a style="color: #6a3906;" name="t12"></a>处理fragment的生命周期<br><br></div><br><div></div><br><div><br><br>管理fragment的生命周期, 大多数地方和管理activity生命周期很像.和activity一样, fragment可以处于3种状态:<br><br>1.  <span style="color: #ff0000;">Resumed</span>在运行中的activity中fragment可见.<br>2.  <span style="color: #ff0000;">Paused</span>另一个activity处于前台并拥有焦点, 但是这个fragment所在的activity仍然可见(前台activity局部透明或者没有覆盖整个屏幕).<br>3.  <span style="color: #ff0000;">Stopped</span>要么是宿主activity已经被停止, 要么是fragment从activity被移除但被添加到后台堆栈中.<br><br>停止状态的fragment仍然活着(所有状态和成员信息被系统保持着). 然而, 它对用户不再可见, 并且如果activity被干掉, 他也会被干掉.<br><br>其对应关系图如下：<br><br><a href="http://www.qiushurong.cn/wp-content/uploads/2014/07/activity_fragment_lifecycle.png" target="_blank" rel="external"><img src="http://www.qiushurong.cn/wp-content/uploads/2014/07/activity_fragment_lifecycle-151x300.png" alt="activity_fragment_lifecycle"></a><br><br>和activity一样, 你可以使用Bundle保持fragment的状态, 万一activity的进程被干掉,并且当activity被重新创建的时候, 你需要恢复fragment的状态时就可以用到. 你可以在fragment的 onSaveInstanceState() 期间保存状态, 并可以在 onCreate(), onCreateView() 或 onActivityCreated() 期间恢复它.<br>生命周期方面activity和fragment之间最重要的区别是各自如何在它的后台堆栈中储存. 在默认情况下, activity在停止后, 它会被放到一个由系统管理的用于保存activity的后台堆栈.(因此用户可以使用BACK按键导航回退到它).<br>然而, 仅当你在一个事务期间移除fragment时,显式调用addToBackStack()请求保存实例时,才被放到一个由宿主activity管理的后台堆栈.<br>另外, 管理fragment的生命周期和管理activity生命周期非常类似.因此, “managing the activitylifecycle”中的相同实践也同样适用于fragment. 你需要理解的是,  activity的生命如何影响fragment的生命.<br><br>### <a style="color: #6a3906;" name="t13"></a><strong>与activity生命周期的协调工作</strong><br><br>fragment所生存的activity的生命周期,直接影响fragment的生命周期,每一个activity的生命周期的回调行为都会引起每一个fragment中类似的回调.<br>例如,当activity接收到onPause()时,activity中的每一个fragment都会接收到onPause().<br>Fragment 有一些额外的生命周期回调方法, 那些是处理与activity的唯一的交互,为了执行例如创建和销毁fragment的UI的动作. 这些额外的回调方法是：<br><br><em>   <strong>onAttach()</strong><br>当fragment被绑定到activity时被调用(Activity会被传入.).
</em>   <strong>onCreateView()</strong><br>创建和fragment关联的view hierarchy时调用.<br><em>   <strong>onActivityCreated()</strong><br>当activity的onCreate()方法返回时被调用.
</em>   <strong>onDestroyView()</strong><br>当和fragment关联的view hierarchy正在被移除时调用.<br><em>   <em>*onDetach()</em></em><br>当fragment从activity解除关联时被调用.<br>fragment生命周期的流程, 以及宿主activity对它的影响,在图3中显示.在这个图中,可以看到activity依次的每个状态是如何决定fragment可能接收到的回调方法.例如, 当activity接收到它的onCreate(),activity中的fragment接收到最多是onActivityCreated().<br>一旦activity到达了resumed状态, 你可以自由地在activity添加和移除fragment.因此,仅当activity处于resumed状态时, fragment的生命周期才可以独立变化.<br>无论如何, 当activity离开resumed状态,fragment再次被activity的推入它自己的生命周期过程.<br><br></div><br>&nbsp;<br><br>&nbsp;<br><br>&nbsp;<br><br>&nbsp;<br><br>&nbsp;<br><br></div><br></div><br></div><br>&nbsp;<br><br>
      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/fragment/" rel="tag">#fragment</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/07/12/css-enqueue/" rel="next" title="wordpress优化-修改/删除CSS加载源地址">
                <i class="fa fa-chevron-left"></i> wordpress优化-修改/删除CSS加载源地址
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014/07/14/eclipse-key/" rel="prev" title="Eclipse-资深程序员必用快捷键集合">
                Eclipse-资深程序员必用快捷键集合 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2014/07/13/android-fragment/"
     data-title="Android之碎片Fragment详解"
     data-content=""
     data-url="http://yoursite.com/2014/07/13/android-fragment/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2014/07/13/android-fragment/"
           data-title="Android之碎片Fragment详解" data-url="http://yoursite.com/2014/07/13/android-fragment/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/head.jpg"
               alt="邱树荣" />
          <p class="site-author-name" itemprop="name">邱树荣</p>
          <p class="site-description motion-element" itemprop="description">致力于计算机程式开发</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">110</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Fragment要点"><span class="nav-number">1.</span> <span class="nav-text">Fragment要点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加一个用户界面"><span class="nav-number">1.1.</span> <span class="nav-text">添加一个用户界面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#撰写代码将fragment添加到一个已存在的ViewGroup"><span class="nav-number">1.2.</span> <span class="nav-text">撰写代码将fragment添加到一个已存在的ViewGroup.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加一个无UI的fragment"><span class="nav-number">1.3.</span> <span class="nav-text">添加一个无UI的fragment</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#管理Fragment"><span class="nav-number">2.</span> <span class="nav-text">管理Fragment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理Fragment事务"><span class="nav-number">3.</span> <span class="nav-text">处理Fragment事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#与Activity通信"><span class="nav-number">4.</span> <span class="nav-text">与Activity通信</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="powered-by" >
  
  <span itemprop="copyrightYear">&copy;2016 - 2026</span>

  <a style="" class="theme-link" href="https://qiushurong.github.io">
    小树技术博客
  </a>

</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  粤ICP备<a class="theme-link" href="https://qiushurong.github.io">
    15021480
  </a>号
</div>

        

        
      </div>
    </footer>

    <!--qsuron20160418 返回顶部更换为火箭
    div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div-->

    <a id="rocket" href="#top" class=""></a>


  </div>


  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"qsuron"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  

  

  

</body>
</html>
